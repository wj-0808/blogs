import{f as E,n as b,y as R,q as M,p as N,u as S,r as u,g as c,j as s,w as a,F as x,o as n,h as v,z as w,s as T,E as f,I,c as K,v as P,_ as $}from"./vue-router-bab8ae27.js";import{B as j}from"./goBack-0f6b545f.js";import{h as p}from"./http-322f23cb.js";const A=["src"],L={key:1,class:"fa fa-plus-square-o font-plus",size:"200px"},G=["href"],H={key:1,class:"fa fa-plus-square-o font-plus",size:"200px"},J=E({__name:"work",setup(O){const o=b({title:"",description:"",keyWords:[],img:"",workUrl:""}),m=R();M(async()=>{let{id:e}=m.query;e&&await B(e)});const B=e=>{p.get("/work/"+e).then(l=>{const r=l.data.article;["title","workUrl","description","keyWords","img"].forEach(t=>{o[t]=r[t]})})},y=N(),_=(e,l="blur")=>({required:!0,message:e,trigger:l}),q=b({title:_("作品标题不能为空"),workUrl:_("请上传作品"),description:_("描述不能为空")}),U=async e=>{let{file:l}=e,r=new FormData;r.append("file",l);let{data:t}=await p.post("/upload/img",r);o.img=t.file.url},V=async e=>{let{file:l}=e,r=new FormData;r.append("file",l);let{data:t}=await p.post("/upload/work",r);o.workUrl=t.work.url},g=()=>{f.success("上传成功")},C=async()=>{await I.prompt("请输入关键字","关键字",{confirmButtonText:"确认",cancelButtonText:"取消"}).then(({value:e})=>o.keyWords.push(e)).catch(()=>console.warn("用户取消操作"))},D=e=>{o.keyWords.splice(0,1)},F=async e=>{e&&await e.validate((l,r)=>{if(l){let t={...o};console.log(t),m.query.id?p.put("/work/"+m.query.id,t).then(d=>{f.success("提交成功")}):p.post("/work",t).then(d=>{f.success("提交成功")})}else f.warning("输入不完整")})};return S(),(e,l)=>{const r=u("el-input"),t=u("el-form-item"),d=u("el-upload"),h=u("el-button"),W=u("el-tag"),z=u("el-form");return n(),c(x,null,[s(j,{content:"作品"}),s(z,{"label-position":"top",ref_key:"ruleFormRef",ref:y,"label-width":"100px","status-icon":"",rules:q,model:o,style:{"max-width":"800px"}},{default:a(()=>[s(t,{label:"标题：",prop:"title"},{default:a(()=>[s(r,{modelValue:o.title,"onUpdate:modelValue":l[0]||(l[0]=i=>o.title=i),placeholder:"Please input",clearable:""},null,8,["modelValue"])]),_:1}),s(t,{label:"描述：",prop:"description"},{default:a(()=>[s(r,{modelValue:o.description,"onUpdate:modelValue":l[1]||(l[1]=i=>o.description=i),placeholder:"Please input",clearable:""},null,8,["modelValue"])]),_:1}),s(t,{label:"封面："},{default:a(()=>[s(d,{class:"uploader","http-request":U,"show-file-list":!1,"on-success":g},{default:a(()=>[o.img?(n(),c("img",{key:0,src:o.img,class:"avatar"},null,8,A)):(n(),c("i",L))]),_:1})]),_:1}),s(t,{label:"文件：",prop:"workUrl"},{default:a(()=>[s(d,{class:"uploader","http-request":V,"show-file-list":!1,"on-success":g},{default:a(()=>[o.workUrl?(n(),c("a",{key:0,href:o.workUrl,target:"_blank",rel:"noopener noreferrer"},"链接",8,G)):(n(),c("i",H))]),_:1})]),_:1}),s(t,{label:"关键字："},{default:a(()=>[v("div",null,[s(h,{size:"small",onClick:C},{default:a(()=>[w("添加")]),_:1}),v("div",null,[(n(!0),c(x,null,T(o.keyWords,(i,k)=>(n(),K(W,{key:k,onClose:Q=>D(k),type:["","success","info","warning","danger"][k%5],size:"small",style:{"margin-right":"5px"},closable:""},{default:a(()=>[w(P(i),1)]),_:2},1032,["onClose","type"]))),128))])])]),_:1}),s(t,null,{default:a(()=>[s(h,{type:"primary",onClick:l[2]||(l[2]=i=>F(y.value))},{default:a(()=>[w("确定")]),_:1})]),_:1})]),_:1},8,["rules","model"])],64)}}});const ee=$(J,[["__file","D:/Code/blogs/web/src/admin/views/work.vue"]]);export{ee as default};
