import{f as x,n as v,q as k,r as u,g as V,j as l,w as r,F as B,E as s,o as h,z as p,c as E,x as z,I as D,_ as M}from"./vue-router-bab8ae27.js";import{h as d}from"./http-322f23cb.js";const N=f=>c=>toString.call(c)==`[object ${f}]`,T=N("String"),$=x({__name:"category",setup(f){const c=v({tableData:[]});k(async()=>{await _()});const y=async(t,a=!1)=>{let{_id:e,name:n,status:m}=t;a&&(n=await g("修改类目",n)),await b(e,{name:n,status:m}),_()},g=async(t,a="")=>{let e;return await D.prompt("请输入类目名",t,{confirmButtonText:"确认",cancelButtonText:"取消",inputValue:a}).then(({value:n})=>e=n).catch(()=>console.warn("用户取消操作")),e},_=async()=>{let t=new Map;await d.get("/category/all").then(a=>{a.data.list.forEach(e=>{e.parent?t.get(e.parent).children.push(e):(e.children=[],t.set(e._id,e))})}),c.tableData=Array.from(t.values())},w=async t=>{let a=await g("添加类目");if(!a)return s.warning("类名不能为空");let e={name:a};T(t)&&(e.parent=t),d.post("/category",e).then(n=>{s.success("添加成功"),_()}).catch(n=>{s.error("添加失败")})},b=async(t,a)=>{if(!a.name)return s.warning("类名不能为空");await d.put("/category/"+t,a).then(e=>{s.success("修改成功")}).catch(e=>{s.error("修改失败")})};return(t,a)=>{const e=u("el-button"),n=u("el-table-column"),m=u("el-switch"),C=u("el-table");return h(),V(B,null,[l(e,{style:{"margin-bottom":"10px"},type:"primary",plain:"",onClick:w},{default:r(()=>[p("新增一级类目")]),_:1}),l(C,{data:c.tableData,border:!0,style:{width:"100%"},"row-key":"_id","empty-text":"没有类目"},{default:r(()=>[l(n,{label:"名称",prop:"name"}),l(n,{label:"状态"},{default:r(o=>[l(m,{modelValue:o.row.status,"onUpdate:modelValue":i=>o.row.status=i,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},size:"small",onChange:i=>y(o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(n,{label:"操作"},{default:r(o=>[l(e,{size:"small",type:"info",plain:"",onClick:i=>y(o.row,!0)},{default:r(()=>[p("修改类目")]),_:2},1032,["onClick"]),o.row.parent?z("v-if",!0):(h(),E(e,{key:0,size:"small",type:"primary",plain:"",onClick:i=>w(o.row._id)},{default:r(()=>[p("添加子类")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])],64)}}});const F=M($,[["__file","D:/Code/blogs/web/src/admin/views/category.vue"]]);export{F as default};
